<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Modernize Free</title>
  <link rel="shortcut icon" type="image/png" href="../src/assets/images/logos/favicon.png" />
  <link rel="stylesheet" href="../src/assets/css/styles.min.css" />
  <style>
    /* Custom CSS for card responsiveness */
    .item-details {
      flex: 1;
    }

    @media (max-width: 768px) {
      /* Adjust container and card layout */
      #list-menu {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
      }

      .card {
        width: 100%; /* Full width on smaller screens */
        margin-bottom: 20px; /* Add margin between cards */
      }

      .card-body {
        display: flex;
        flex-direction: column;
        align-items: center; /* Center items vertically */
      }

      .item-details {
        flex: 1;
        text-align: center; /* Center text */
      }

      .item-image {
        margin-top: 10px; /* Add space between details and image */
        text-align: center; /* Center image */
      }

      .item-image img {
        max-width: 100%; /* Ensure image scales properly */
        height: auto; /* Maintain aspect ratio */
      }
    }
  </style>
</head>

<body>
  <!--  Body Wrapper -->
  <div class="page-wrapper" id="main-wrapper" data-layout="vertical" data-navbarbg="skin6" data-sidebartype="full"
    data-sidebar-position="fixed" data-header-position="fixed">
    <div id="navbar"></div>
    <!--  Main wrapper -->
    <div class="body-wrapper">
      <!--  Header Start -->
      <div id="header"></div>
      <!--  Header End -->
      <div class="container-fluid">
        <div class="card shadow-lg">
          <div class="card-body">
            <h5 class="card-title fw-semibold mb-4">รายการสินค้า</h5>
            <div id="list-menu" class="container mt-4">
              <!-- Cards will be dynamically added here -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script src="../src/assets/libs/jquery/dist/jquery.min.js"></script>
  <script src="../src/assets/libs/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
  <script src="../src/assets/js/sidebarmenu.js"></script>
  <script src="../src/assets/js/app.min.js"></script>
  <script src="../src/assets/libs/simplebar/dist/simplebar.js"></script>
  <script>
    $(document).ready(function () {
      // Load header and footer content
      $("#navbar").load("navbar.html");
      $("#header").load("header.html");

      // Function to fetch items from API
      function fetchItems(page) {
        return fetch(`../api/select_item.php?case=items&page=${page}`, {
          method: 'POST',
          body: JSON.stringify({
            case: 'items',
          }),
        })
        .then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          return response.json();
        })
        .catch(error => {
          console.error('Error fetching items:', error);
        });
      }

      // Function to render card based on viewport size
      function renderCard(item) {
        if ($(window).width() >= 768) { // Render PC card on screens 768px and above
          $('#list-menu').append(`
            <div class="card shadow-lg d-none d-md-block">
              <div class="card-body d-flex justify-content-between align-items-center">
                <div class="item-details">
                  <h2 class="card-title">รหัสสินค้า: ${item.item_id}</h2>
                  <h2 class="card-title">ชื่อสินค้า: ${item.item_name}</h2>
                  <p class="card-text">ประเภทสินค้า: ${item.item_type}</p>
                  <p class="card-text">ราคา: ${formatNumberWithCommas(item.item_price)} บาท</p>
                  <p class="card-text">ราคาดอกเบี้ย: ${per_interest(item.item_price, item.item_interest)}  บาท</p>
                  <p class="card-text">วันที่ครบกำหนดชำระดอก: ${addDATE(item.item_d_create, item.item_d_interest)}</p>
                  <p class="card-text">เพิมสินค้า: ${changeformate(item.item_d_create)}</p>
                </div>
                <div class="item-image ml-3">
                  <img src="../src/assets/images/product/${item.item_pic}" class="img-fluid rounded"
                    style="max-width: 150px; height: auto;" alt="Product Image">
                </div>
              </div>
            </div>
          `);
        } else { // Render mobile card on screens below 768px
          $('#list-menu').append(`
            <div class="card d-block d-md-none">
              <img src="../src/assets/images/product/${item.item_pic}" style="max-width: 266px max-height: 266px;" class="card-img-top" alt="...">
              <div class="card-body">
                <h5 class="card-title">รหัส ${item.item_id}</h5>
                <h5 class="card-title">ชื่อสินค้าบาท ${item.item_name}</h5>
                  <p class="card-text">ประเภทสินค้า: ${item.item_type}</p>
                  <p class="card-text">ราคา: ${formatNumberWithCommas(item.item_price)} บาท</p>
                  <p class="card-text">ราคาดอกเบี้ย: ${per_interest(item.item_price, item.item_interest)}  บาท</p>
                  <p class="card-text text-center" style="margin: 0px">วันที่ครบกำหนดชำระดอก:</p>
                  <p class="card-text">${addDATE(item.item_d_create, item.item_d_interest)}</p>
                  <p class="card-text">เพิ่มสินค้า: ${changeformate(item.item_d_create)}</p>
              </div>
            </div>
          `);
        }
      }

      // Function to handle fetching and rendering items
      function handleFetchAndRender() {
        let page = 1;
        fetchItems(page)
          .then(data => {
            data.forEach(item => {
              renderCard(item);
            });
            page++; // Increment page for next fetch
          });

        // Detect when user scrolls to the bottom
        $(window).scroll(function() {
          if ($(window).scrollTop() + $(window).height() >= $(document).height() - 200) {
            fetchItems(page)
              .then(data => {
                data.forEach(item => {
                  renderCard(item);
                });
                page++; // Increment page for next fetch
              });
          }
        });
      }

      // Call function to handle initial fetch and render
      handleFetchAndRender();

      // Call handleFetchAndRender on window resize to re-render cards based on viewport size
      $(window).resize(function() {
        $('#list-menu').empty(); // Clear previous content
        handleFetchAndRender();
      });

      // Helper functions
      const formatNumberWithCommas = (number) => {
        return number.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
      };

      const addDATE = (datetime, days) => {
        let date = new Date(datetime);
        date.setDate(date.getDate() + days);
        let daysOfWeek = ['วันอาทิตย์', 'วันจันทร์', 'วันอังคาร', 'วันพุธ', 'วันพฤหัสบดี', 'วันศุกร์', 'วันเสาร์'];
        let dayName = daysOfWeek[date.getDay()];
        let formattedDate = `${dayName} ${date.getDate()}/${date.getMonth() + 1}/${date.getFullYear()}`;
        return formattedDate;
      };

      const changeformate = (datetime) => {
        let date = new Date(datetime);
        let daysOfWeek = ['วันอาทิตย์', 'วันจันทร์', 'วันอังคาร', 'วันพุธ', 'วันพฤหัสบดี', 'วันศุกร์', 'วันเสาร์'];
        let dayName = daysOfWeek[date.getDay()];
        let formattedDate = ` ${dayName} ${date.getDate()}/${date.getMonth() + 1}/${date.getFullYear()}`;
        return formattedDate;
      };

      // ดอกเบี้ย %
      const per_interest = (number , rate) => {
        let num = number * (rate / 100);
        return num.toFixed(2);
      } 
    });
  </script>
</body>

</html>
