<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>thunder-cash</title>
  <link rel="shortcut icon" type="image/png" href="../src/assets/images/logos/favicon.png" />
  <link rel="stylesheet" href="../src/assets/css/styles.min.css" />
<style>
button[type="button"] {
  transition: transform 0.3s ease;
}

button[type="button"]:hover {
  transform: scale(1.1);
}

.app-header {
  position: fixed;
  width: 100%;
  transition: transform 0.3s ease-in-out, visibility 0.3s ease-in-out;
  z-index: 1000;
}

.app-header.hidden {
  transform: translateY(-100%);
  visibility: hidden;
}

  </style>
</head>

<body>
  <!--  Body Wrapper -->
  <div class="page-wrapper" id="main-wrapper" data-layout="vertical" data-navbarbg="skin6" data-sidebartype="full"
    data-sidebar-position="fixed" data-header-position="fixed">
    <div id="navbar"></div>
    <!--  Main wrapper -->
    <div class="body-wrapper">
      <!--  Header Start -->
      <div id="header"></div>
      <!--  Header End -->
      <div class="container-fluid">
        <div class="container-fluid">
          <div class="card">
            <div class="card-body shadow-lg">
              <h5 class="card-title fw-semibold mb-4">เพิ่มสินค้า</h5>
              <form id="formitem" enctype="multipart/form-data">
                <div class="col col-md-6 text-center mx-auto">
                  <img id="image_pre" class="w-75 rounded mb-3" src="../src/assets/images/image/no-img.png" alt="">
                </div>
                <div class="text-center mb-3">
                  <label class="form-label" for="image_upload">
                    <button type="button" class="btn btn-lg btn-primary" id="image_upload_btn">ถ่ายภาพ</button>
                  </label>
                  <input type="file" id="image_upload" name="img" accept="image/*;capture=camera" class="form-control"
                    hidden>
                </div>
                <div class="row g-2 mb-3">
                  <div class="form-floating col-12 mb-3">
                    <input type="text" class="form-control" id="name_item" placeholder="ชื่อสินค้า">
                    <label for="name_item" class="form-label">ชื่อสินค้า</label>
                  </div>
                  <div class="col-12 col-md-3 mb-3">
                    <div class="form-floating">
                      <select class="form-select" id="group_item">
                        <option selected>-หมวดหมู่-</option>
                        <option value="1">มือถือ</option>
                        <option value="2">กล้อง</option>
                        <option value="3">รถยนต์</option>
                        <option value="4">มอเตอร์ไซต์</option>
                        <option value="5">นาฬิกา</option>
                        <option value="6">กระเป๋า</option>
                        <option value="7">ทีวี</option>
                        <option value="8">อสังหาริมทรัพย์</option>
                      </select>
                      <label for="group_item" class="form-label">หมวดหมู่</label>
                    </div>
                  </div>
                  <div class="form-floating col-12 col-md-3 mb-3">
                    <input type="number" class="form-control" id="price_item" placeholder="ราคา">
                    <label for="price_item" class="form-label">ราคา</label>
                  </div>
                  <div class="form-floating col-12 col-md-3 mb-3">
                    <input type="number" class="form-control" id="per-interest" placeholder="ดอกเบี้ย">
                    <label for="per-interest" class="form-label"> % ดอกเบี้ย</label>
                  </div>
                  <div class="form-floating col-12 col-md-3 mb-3">
                    <input type="number" class="form-control" id="date-interest" placeholder="จ่ายดอก">
                    <label for="date-interest" class="form-label">ระยะเวลาการจ่ายดอก(วัน)</label>
                  </div>
                </div>
                <div class="text-center mb-3">
                  <button type="button" class="btn btn-primary" onclick="confirm()">บันทึก</button>
                </div>
              </form>
              <div class="alert alert-success" role="alert" style="display: none;">
                เพิ่มรายการสำเร็จ
              </div>
              <div class="alert alert-danger" role="alert" style="display: none;">
                เพิ่มรายการไม่สำเร็จ
              </div>
              <!-- Modal -->
                <div class="modal top fade" id="confirmModal" tabindex="-1" aria-labelledby="exampleModalLabel"
                  aria-hidden="true" data-mdb-backdrop="true" data-mdb-keyboard="true">
                  <div class="modal-dialog   modal-dialog-centered">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" id="confirmModalLabel">ยืนยัน</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body">ยืนยันการเพิ่มสินค้าหรือไม่</div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                          ยกเลิก
                        </button>
                        <button type="button" class="btn btn-primary" onclick="form_data()">ยืนยัน</button>
                      </div>
                    </div>
                  </div>
                </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script src="../src/assets/libs/jquery/dist/jquery.min.js"></script>
  <script src="../src/assets/libs/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
  <script src="../src/assets/js/sidebarmenu.js"></script>
  <script src="../src/assets/js/app.min.js"></script>
  <script src="../src/assets/libs/simplebar/dist/simplebar.js"></script>
</body>
<script>
  $(document).ready(function () {
    // Load header and footer content
    $("#navbar").load("navbar.html");
    $("#header").load("header.html");
  });

  $("#image_upload_btn").on("click", () => {
    $("#image_upload").click();
  });

  $("#image_upload").on("change", () => {
    previewImg();
  });
  previewImg = () => {
    const fileInput = document.getElementById('image_upload');
    const img = document.getElementById('image_pre');

    const [file] = fileInput.files;
    if (file) {
      img.src = URL.createObjectURL(file);
    }
  }

  // getdatenow = () => {
  //   var timestamp = Date.now();
  //   var localDateTime = new Date(timestamp);
  //   localDateTime.setHours(localDateTime.getHours() + 7);
  //   var datetimeNow = localDateTime.toISOString();
  //   return datetimeNow;
  // }

  form_data = () => {
    const formElement = $("#formitem")[0];
    const formData = new FormData(formElement);

    formData.append('case', 'insert');
    formData.append('item_name', $('#name_item').val());
    formData.append('item_group', $('#group_item').val());
    formData.append('item_group_name', $('#group_item').find(':selected').text());
    formData.append('item_price', $('#price_item').val());
    formData.append('item_interest', $('#per-interest').val());
    formData.append('item_interest_date', $('#date-interest').val());
    // formData.append('date_created', getdatenow());

    insert(formData);

  }

  insert = (formData) => {
    fetch('../api/insert_item.php?case=insert', {
      method: 'POST',
      body: formData,
    })
    .then(res => {
      if (!res.ok) {
        throw new Error('Network response was not ok');
      }
      return res.json();
    })
      .then(res => {
        console.log(res);
        $('#confirmModal').modal('hide');
        if (res.status === 1) {
          $('.alert-success').show();
          setTimeout(() => {
            location.reload();
          }, 2000);
        } else {
          $('.alert-danger').show();
        }
      })
      .catch(err => {
        console.error('เกิดข้อผิดพลาดในการเชื่อมต่อ:', err);
        alert('เกิดข้อผิดพลาดในการเชื่อมต่อ');
      });
  }

  confirm = () => {
    $('#confirmModal').modal('show');
  }

  let lastScrollTop = 0;

window.addEventListener('scroll', function() {
  let scrollTop = window.pageYOffset || document.documentElement.scrollTop;

  if (scrollTop > lastScrollTop) {
    $('.app-header').addClass('hidden');
  } else {
    $('.app-header').removeClass('hidden');
  }

  lastScrollTop = scrollTop;
});
</script>

</html>